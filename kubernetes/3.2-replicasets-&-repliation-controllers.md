# ReplicaSets & Replication Controllers

* [ReplicaSets & Replication Controllers concept](https://github.com/Ariel-Yu/knowledge-bases/blob/master/kubernetes/replicasets-%26-repliation-controllers.md#replicasets--replication-controllers-concept)
 * [ReplicaSets](https://github.com/Ariel-Yu/knowledge-bases/blob/master/kubernetes/replicasets-%26-repliation-controllers.md#replicasets)
 * [Scale & Update with ReplicaSets](https://github.com/Ariel-Yu/knowledge-bases/blob/master/kubernetes/replicasets-%26-repliation-controllers.md#scale--update)
 * [Replication Controllers](https://github.com/Ariel-Yu/knowledge-bases/blob/master/kubernetes/replicasets-%26-repliation-controllers.md#replication-controllers)

## ReplicaSets & Replication Controllers concept

- **High Availability**: A replicaset/replication controller guarantees that there will be always **desired** number of pods running in the cluster
  - Even a single-pod node should have a replicaset/replication controller
- **Load Balancing & Scale**: A replicaset/replication controller oversees all the pods across different nodes in the cluster and one can scale up/down the application through the replicaset/replication controller by modifying their definitions
- ReplicaSet is the newer way than Replication Controller to oversee all the pods

## ReplicaSets

- **selector** under the spec section is required for replicaset
- A replicaset is assigned to the pods by the definitions under MatchLabels (in this case, pods with `tier: front-end`)
- With 3 pods running, after deleting a pod, a new pod will be automatically generated by the replicaset
- With 3 pods running, after adding a new pod, the new pod will be immediately in the terminating status

replicaset-definition.yml
```
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myapp-replicaset
  labels:
    name: myapp
    tier: front-end

spec:
  template:
    
    metadata:
      name: ariel-pod
      labels:
        name: ariel
        tier: front-end
    spec:
      containers:
        - name: nginx-container
          image: nginx

  replicas: 3
  selector:
    matchLabels:
      tier: front-end
```

Create a replicaset with 3 pods with a yaml file
```
kubectl create -f replicaset-definition.yml

<SHORTNAME of replicasets = rs>
kubectl get replicasets [<replicaset_name>]
kubectl get replicasets [<replicaset_name>] -o wide
kubectl describe replicasets [<replicaset_name>]
kubectl explain replicasets

kubectl delete replicasets <replicaset_name>
```

## Scale & Update

```
kubectl scale --replicas=6 -f replicaset-definition.yml -> Scale up by the definition file. Hint: the file is not modified
kubectl scale --replicat=3 replicaset myapp-replicaset -> Scale up by cli

kubectl replace -f replicaset-definition.yml -> Replace replicaset settings with the edited file
kubectl edit replicaset new-replica-set -> Update the definition file of the replicaset in console
kubectl set image replicaset/<replicaset_name> <container_name>:<new_image_name>
```

## Replication Controllers

rc-definition.yml
```
apiVersion: v1
kind: ReplicationController
metadata:
  name: myapp-rc
  labels:
    name: myapp
    tier: front-end

spec:
  template:

    metadata:
      name: ariel-pod
      labels:
        name: ariel
        tier: front-end
    spec:
      containers:
        - name: nginx-container
          image: nginx

  replicas: 3
```

Create a replication controller with 3 pods with a yaml file
```
kubectl create -f rc-definition.yml

kubectl get replicationcontrollers [<replicaion_controller_name>]
kubectl get replicationcontrollers [<replicaion_controller_name>] -o wide

kubectl describe replicationcontrollers <replicaion_controller_name>
```
