# Controllers

* [Replication Controllers & ReplicaSets]()
    * [Replication Controllers yml]()
    * [ReplicaSets yml]()
    * [Scale with ReplicaSets]()
* [Node Controller]()

## Replication Controllers & ReplicaSets
- **High Availability**: A replication controller/replicaset guarantees that there will be always specified number of pods running in the cluster
  - Even a single-pod node should have a replication controller/replicaset
- **Load Balancing & Scale**: A replication controller/replicaset oversees all the pods across different nodes in the cluster
- ReplicaSet is the newer way than Replication Controller to oversee all the pods

### Replication Controllers yml

rc-definition.yml
```
apiVersion: v1
kind: ReplicationController
metadata:
  name: myapp-rc
  labels:
    name: myapp
    tier: front-end

spec:
  template:

    metadata:
      name: ariel-pod
      labels:
        name: ariel
        tier: front-end
    spec:
      containers:
        - name: nginx-container
          image: nginx

  replicas: 3
```

Create a replication controller with 3 pods with a yaml file
```
kubectl create -f rc-definition.yml

kubectl get replicationcontroller
kubectl get nodes
kubectl get pods
```

### ReplicaSets yml

replicaset-definition.yml

- **selector** under the spec section is required for replicaset
- A replicaset is assigned to the pods by the definitions under MatchLabels (in this case, pods with `tier: front-end`)
- With 3 pods running, after deleting a pod, a new pod will be automatically generated by the replicaset
- With 3 pods running, after adding a new pod, the new pod will be immediately in the terminating status
```
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myapp-replicaset
  labels:
    name: myapp
    tier: front-end

spec:
  template:
    
    metadata:
      name: ariel-pod
      labels:
        name: ariel
        tier: front-end
    spec:
      containers:
        - name: nginx-container
          image: nginx

  replicas: 3
  selector:
    matchLabels:
      tier: front-end
```

Create a replicaset with 3 pods with a yaml file
```
kubectl create -f replicaset-definition.yml

kubectl get replicasets
kubectl describe replicasets [<replicaset_name>]
kubectl delete replicasets <replicaset_name>
kubectl get nodes
kubectl get pods
```

### Scale

```
kubectl replace -f replicaset-definition.yml
kubectl scale --replicas=6 -f replicaset-definition.yml
kubectl scale --replicat=3 replicaset myapp-replicaset
```

## Node Controllers
